import{g as e,h as a,m as l,i as n,K as t,l as s,P as u,x as o,t as i,Q as r,F as c,R as d,S as m,a as v}from"./page-wraper.7cfd0783.js";import{d as p,r as h,q as g,h as f,j as y,o as w,c as b,w as k,a as x,p as _,x as C,e as K,F as $,f as S,n as I,b as V,t as P,a6 as E,i as F,a9 as O,aa as j,y as D}from"./index-bc8b5b89.js";function H(e,a,l){let n=s(e)?e:[e];const t=new Set(e.map(u));if(1!==t.size&&t.has("object"))throw Error("The columns are correct");s(e[0])||(n=[n]);return n.map((e=>e.map((e=>{if(!o(e))return{[a]:e,[l]:e};if(!e.hasOwnProperty(a)&&!e.hasOwnProperty(l))throw Error("Can't find valueKey and labelKey in columns");return e.hasOwnProperty(l)||(e[l]=e[a]),e.hasOwnProperty(a)||(e[a]=e[l]),e}))))}const T=v(p({name:"wd-picker-view",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{...e,loading:a(!1),loadingColor:l("#4D80F0"),columnsHeight:n(217),valueKey:l("value"),labelKey:l("label"),modelValue:{type:[String,Number,Boolean,Array,Array,Array],default:"",required:!0},columns:t(),columnChange:Function},emits:["change","pickstart","pickend","update:modelValue"],setup(e,{expose:a,emit:l}){const n=e,t=h([]),o=h(35),v=h([]),p=h([]);g((()=>n.modelValue),((e,a)=>{!r(a,e)&&e&&A(e)}),{deep:!0,immediate:!0}),g((()=>n.columns),(e=>{t.value=H(e,n.valueKey,n.labelKey),A(n.modelValue)}),{deep:!0,immediate:!0}),g((()=>v.value),(e=>{r(e,p.value)||r(B(),n.modelValue)||R(0)}),{deep:!0,immediate:!0}),g((()=>n.columnChange),(e=>{e&&!c(e)&&console.error("The type of columnChange must be Function")}),{deep:!0,immediate:!0});const{proxy:T}=D();function A(e){if(0===n.columns.length)return;(""===e||null==e||s(e)&&0===e.length)&&(e=t.value.map((e=>e[0][n.valueKey])));const a=u(e),l=["string","number","boolean","array"];-1===l.indexOf(a)&&console.error(`value must be one of ${l.toString()}`),0===t.value.length&&(t.value=H(n.columns,n.valueKey,n.labelKey)),0===(e=(e=s(e)?e:[e]).slice(0,t.value.length)).length&&(e=t.value.map((()=>0)));let o=d(v.value);e.forEach(((e,a)=>{let l=t.value[a].findIndex((a=>a[n.valueKey].toString()===e.toString()));l=-1===l?0:l,o=q(a,l)})),v.value=o.slice(0,e.length)}function q(e,a){const l=t.value[e];if(!l||!l[a])throw Error(`The value to select with Col:${e} Row:${a} is correct`);const n=d(v.value);if(l[a].disabled){const t=l.slice(0,a).reverse().findIndex((e=>!e.disabled)),s=l.slice(a+1).findIndex((e=>!e.disabled));-1!==t?n[e]=a-1-t:-1!==s?n[e]=a+1+s:void 0===n[e]&&(n[e]=0)}else n[e]=a;return v.value=d(n),v.value}function N({detail:{value:e}}){const a=function(e){e=e.slice(0,t.value.length);const a=d(v.value);let l=d(v.value);e.forEach(((e,n)=>{(e=m(e,0,t.value[n].length-1))!==a[n]&&(l=q(n,e))})),v.value=l,p.value=a;const n=function(e,a){if(!e||!a)return-1;const l=e.findIndex(((e,l)=>e!==a[l]));return l}(l,a);if(-1===n)return;const s=l[n];return 1===l.length?s:n}(e=e.map((e=>Number(e||0))));v.value=d(e),E((()=>{n.columnChange?n.columnChange.length<4?(n.columnChange(T.$.exposed,z(),a||0,(()=>{})),R(a||0)):n.columnChange(T.$.exposed,z(),a||0,(()=>{R(a||0)})):R(a||0)}))}function R(e){const a=B();r(a,n.modelValue)||(l("update:modelValue",a),setTimeout((()=>{l("change",{picker:T.$.exposed,value:a,index:e})}),0))}function z(){const e=v.value.map(((e,a)=>t.value[a][e]));return 1===e.length?e[0]:e}function B(){const{valueKey:e}=n,a=v.value.map(((a,l)=>t.value[l][a][e]));return 1===a.length?a[0]:a}function G(){l("pickstart")}function L(){l("pickend")}return a({getSelects:z,getValues:B,setColumnData:function(e,a,l=0){v.value=q(e,l),t.value[e]=H(a,n.valueKey,n.labelKey).reduce(((e,a)=>e.concat(a)),[])},getColumnsData:function(){return t.value.slice(0)},getColumnData:function(e){return t.value[e]},getColumnIndex:function(e){return v.value[e]},getLabels:function(){const{labelKey:e}=n;return v.value.map(((a,l)=>t.value[l][a][e]))},getSelectedIndex:function(){return v.value}}),(e,a)=>{const l=f(y("wd-loading"),i),n=F,s=O,u=j;return w(),b(n,{class:I(`wd-picker-view ${e.customClass}`),style:C(e.customStyle)},{default:k((()=>[e.loading?(w(),b(n,{key:0,class:"wd-picker-view__loading"},{default:k((()=>[x(l,{color:e.loadingColor},null,8,["color"])])),_:1})):_("",!0),x(n,{style:C(`height: ${e.columnsHeight-20}px;`)},{default:k((()=>[x(u,{"mask-class":"wd-picker-view__mask","indicator-class":"wd-picker-view__roller","indicator-style":`height: ${o.value}px;`,style:C(`height: ${e.columnsHeight-20}px;`),value:v.value,onChange:N,onPickstart:G,onPickend:L},{default:k((()=>[(w(!0),K($,null,S(t.value,((a,l)=>(w(),b(s,{key:l,class:"wd-picker-view-column"},{default:k((()=>[(w(!0),K($,null,S(a,((a,t)=>(w(),b(n,{key:t,class:I(`wd-picker-view-column__item ${a.disabled?"wd-picker-view-column__item--disabled":""}  ${v.value[l]==t?"wd-picker-view-column__item--active":""}`),style:C(`line-height: ${o.value}px;`)},{default:k((()=>[V(P(a[e.labelKey]),1)])),_:2},1032,["class","style"])))),128))])),_:2},1024)))),128))])),_:1},8,["indicator-style","style","value"])])),_:1},8,["style"])])),_:1},8,["class","style"])}}}),[["__scopeId","data-v-71bb64dc"]]);export{T as _,H as f};
