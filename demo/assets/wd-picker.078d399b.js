import{d as e,r as l,v as a,q as s,m as o,N as t,h as u,j as n,o as r,c as i,w as c,a as d,z as m,n as p,u as v,x as f,e as g,F as y,b as _,t as b,p as h,a6 as k,i as w,y as V}from"./index-bc8b5b89.js";import{g as C,m as S,h as x,i as $,K as F,M as K,p as I,o as T,R as z,l as j,P as q,T as A,b as B,r as M,F as L,N as O,a as W}from"./page-wraper.7cfd0783.js";import{f as D,_ as H}from"./wd-picker-view.eed693f2.js";import{u as P}from"./useTranslate.670742f3.js";const N=W(e({name:"wd-picker",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{...C,customLabelClass:S(""),customValueClass:S(""),customViewClass:S(""),label:String,placeholder:String,disabled:x(!1),readonly:x(!1),loading:x(!1),loadingColor:S("#4D80F0"),title:String,cancelButtonText:String,confirmButtonText:String,required:x(!1),size:String,labelWidth:String,useDefaultSlot:x(!1),useLabelSlot:x(!1),error:x(!1),alignRight:x(!1),beforeConfirm:Function,closeOnClickModal:x(!0),safeAreaInsetBottom:x(!0),ellipsis:x(!1),columnsHeight:$(217),valueKey:S("value"),labelKey:S("label"),modelValue:{type:[String,Number,Array],default:""},columns:{type:Array,default:()=>[]},columnChange:Function,displayFormat:Function,zIndex:$(15),prop:String,rules:F()},emits:["confirm","open","cancel","update:modelValue"],setup(e,{expose:C,emit:S}){const x=e,{translate:$}=P("picker"),F=l(null),W=K(),N=l(!1),R=l(!1),U=l(""),E=l(""),G=l([]),J=l([]),Q=l(!1),X=l(!1),Y=a((()=>x.loading||N.value));s((()=>x.displayFormat),(e=>{e&&!L(e)&&console.error("The type of displayFormat must be Function"),F.value&&F.value.selectedIndex&&0!==F.value.selectedIndex.length&&(T(x.modelValue)&&""!==x.modelValue?ie(F.value.getSelects()):U.value="")}),{immediate:!0,deep:!0}),s((()=>x.modelValue),(e=>{E.value=e,T(e)&&""!==e?F.value&&F.value.getSelects?k((()=>{ie(F.value.getSelects())})):ie(se(e)):U.value=""}),{deep:!0,immediate:!0}),s((()=>x.columns),(e=>{G.value=e,J.value=e,T(x.modelValue)&&""!==x.modelValue?F.value&&F.value.getSelects?k((()=>{ie(F.value.getSelects())})):ie(se(x.modelValue)):U.value=""}),{deep:!0,immediate:!0}),s((()=>x.columnChange),(e=>{e&&!L(e)&&console.error("The type of columnChange must be Function")}),{deep:!0,immediate:!0});const{parent:Z}=I(O),ee=a((()=>Z&&x.prop&&Z.errorMessages&&Z.errorMessages[x.prop]?Z.errorMessages[x.prop]:"")),le=a((()=>{let e=!1;if(Z&&Z.props.rules){const l=Z.props.rules;for(const a in l)Object.prototype.hasOwnProperty.call(l,a)&&a===x.prop&&Array.isArray(l[a])&&(e=l[a].some((e=>e.required)))}return x.required||x.rules.some((e=>e.required))||e})),{proxy:ae}=V();function se(e){const l=D(x.columns,x.valueKey,x.labelKey);if(0===x.columns.length)return;if(""===e||!T(e)||j(e)&&0===e.length)return;const a=q(e);if(-1===["string","number","boolean","array"].indexOf(a))return[];0===(e=(e=j(e)?e:[e]).slice(0,l.length)).length&&(e=l.map((()=>0)));let s=[];e.forEach(((e,a)=>{let o=l[a].findIndex((l=>l[x.valueKey].toString()===e.toString()));o=-1===o?0:o,s.push(o)}));const o=s.map(((e,a)=>l[a][e]));return 1===o.length?o[0]:o}function oe(){x.disabled||x.readonly||(S("open"),R.value=!0,E.value=x.modelValue,G.value=J.value)}function te(){R.value=!1,S("cancel")}function ue(){if(Y.value)return;if(Q.value)return void(X.value=!0);const{beforeConfirm:e}=x;e&&L(e)?e(E.value,(e=>{e&&ne()}),ae.$.exposed):ne()}function ne(){if(Y.value||x.disabled)return void(R.value=!1);const e=F.value.getSelects(),l=F.value.getValues(),a=F.value.getColumnsData();R.value=!1,J.value=z(a),S("update:modelValue",l),ie(e),S("confirm",{value:l,selectedItems:e})}function re({value:e}){E.value=e}function ie(e){if(j(e)&&!e.length||!e)return;const{valueKey:l,labelKey:a}=x;U.value=(x.displayFormat||A)(e,{valueKey:l,labelKey:a})}function ce(){}function de(){Q.value=!0}function me(){Q.value=!1,X.value&&(X.value=!1,ue())}return o((()=>{T(x.modelValue)&&""!==x.modelValue&&ie(se(x.modelValue)),T(x.modelValue)&&""!==x.modelValue&&F.value&&F.value.getSelects&&ie(F.value.getSelects())})),t((()=>{G.value=z(x.columns),J.value=z(x.columns)})),C({close:function(){te()},open:function(){oe()},setLoading:function(e){N.value=e}}),(e,l)=>{const a=w,s=u(n("wd-icon"),B),o=u(n("wd-picker-view"),H),t=u(n("wd-popup"),M);return r(),i(a,{class:p(`wd-picker ${e.disabled?"is-disabled":""} ${e.size?"is-"+e.size:""}  ${v(W).border.value?"is-border":""} ${e.alignRight?"is-align-right":""} ${e.error?"is-error":""} ${e.customClass}`),style:f(e.customStyle)},{default:c((()=>[d(a,{class:"wd-picker__field",onClick:oe},{default:c((()=>[e.useDefaultSlot?m(e.$slots,"default",{key:0},void 0,!0):(r(),i(a,{key:1,class:"wd-picker__cell"},{default:c((()=>[e.label||e.useLabelSlot?(r(),i(a,{key:0,class:p(`wd-picker__label ${e.customLabelClass}  ${v(le)?"is-required":""}`),style:f(e.labelWidth?"min-width:"+e.labelWidth+";max-width:"+e.labelWidth+";":"")},{default:c((()=>[e.label?(r(),g(y,{key:0},[_(b(e.label),1)],64)):m(e.$slots,"label",{key:1},void 0,!0)])),_:3},8,["class","style"])):h("",!0),d(a,{class:"wd-picker__body"},{default:c((()=>[d(a,{class:"wd-picker__value-wraper"},{default:c((()=>[d(a,{class:p(`wd-picker__value ${e.ellipsis&&"is-ellipsis"} ${e.customValueClass} ${U.value?"":"wd-picker__placeholder"}`)},{default:c((()=>[_(b(U.value?U.value:e.placeholder||v($)("placeholder")),1)])),_:1},8,["class"]),e.disabled||e.readonly?h("",!0):(r(),i(s,{key:0,"custom-class":"wd-picker__arrow",name:"arrow-right"}))])),_:1}),v(ee)?(r(),i(a,{key:0,class:"wd-picker__error-message"},{default:c((()=>[_(b(v(ee)),1)])),_:1})):h("",!0)])),_:1})])),_:3}))])),_:3}),d(t,{modelValue:R.value,"onUpdate:modelValue":l[1]||(l[1]=e=>R.value=e),position:"bottom","hide-when-close":!1,"close-on-click-modal":e.closeOnClickModal,"z-index":e.zIndex,"safe-area-inset-bottom":e.safeAreaInsetBottom,onClose:te,"custom-class":"wd-picker__popup"},{default:c((()=>[d(a,{class:"wd-picker__wraper"},{default:c((()=>[d(a,{class:"wd-picker__toolbar",onTouchmove:ce},{default:c((()=>[d(a,{class:"wd-picker__action wd-picker__action--cancel",onClick:te},{default:c((()=>[_(b(e.cancelButtonText||v($)("cancel")),1)])),_:1}),e.title?(r(),i(a,{key:0,class:"wd-picker__title"},{default:c((()=>[_(b(e.title),1)])),_:1})):h("",!0),d(a,{class:p("wd-picker__action "+(v(Y)?"is-loading":"")),onClick:ue},{default:c((()=>[_(b(e.confirmButtonText||v($)("done")),1)])),_:1},8,["class"])])),_:1}),d(o,{ref_key:"pickerViewWd",ref:F,"custom-class":e.customViewClass,modelValue:E.value,"onUpdate:modelValue":l[0]||(l[0]=e=>E.value=e),columns:G.value,loading:v(Y),"loading-color":e.loadingColor,"columns-height":e.columnsHeight,"value-key":e.valueKey,"label-key":e.labelKey,onChange:re,onPickstart:de,onPickend:me,"column-change":e.columnChange},null,8,["custom-class","modelValue","columns","loading","loading-color","columns-height","value-key","label-key","column-change"])])),_:1})])),_:1},8,["modelValue","close-on-click-modal","z-index","safe-area-inset-bottom"])])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-b4382c64"]]);export{N as _};
