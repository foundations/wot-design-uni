import{L as e,d as s,r as a,q as o,h as t,j as i,o as l,c as n,w as u,e as r,F as c,f as d,n as f,a as m,b as p,t as v,p as y,u as _,z as h,x as w,k as b,i as g,g as F,Y as k,A as C,I as T,ae as z}from"./index-bc8b5b89.js";import{g as x,K as L,m as P,h as D,i as S,t as I,b as j,Q as U,W as E,F as K,P as A,o as M,a as N}from"./page-wraper.7cfd0783.js";import{u as R}from"./useTranslate.670742f3.js";const O=N(s({name:"wd-upload",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...x,fileList:L(),action:P(""),header:{type:Object,default:()=>{}},multiple:D(!1),disabled:D(!1),limit:S(0),showLimitNum:D(!0),maxSize:S(Number.MAX_VALUE),sourceType:L(),sizeType:L(),name:P("file"),formData:{type:Object,default:()=>{}},onPreviewFail:Function,beforeUpload:Function,beforeChoose:Function,beforeRemove:Function,beforePreview:Function,buildFormData:Function,loadingType:P("ring"),loadingColor:P("#ffffff"),accept:P("image"),statusKey:P("status"),useDefaultSlot:D(!1),loadingSize:P("24px"),customEvokeClass:P(""),customPreviewClass:P(""),imageMode:P("aspectFit")},emits:["fail","change","success","progress","oversize","chooseerror","remove"],setup(s,{emit:x}){const L=s,{translate:P}=R("upload"),D=a([]);function S(e,s,a){const{statusKey:o}=L,t=D.value.findIndex((e=>e.uid===s.uid));t>-1&&(D.value[t][o]="fail",D.value[t].error=e.message,D.value[t].response=e,x("fail",{error:e,file:s,formData:a}))}function N(e,s){const{action:a,name:o,header:t={},accept:i}=L;z({url:a,header:t,name:o,fileName:o,fileType:i,formData:s,filePath:e.url,success(a){200===a.statusCode?function(e,s,a){const{statusKey:o}=L,t=D.value.findIndex((e=>e.uid===s.uid));t>-1&&(D.value[t][o]="success",D.value[t].response=e.data,x("change",{fileList:D.value}),x("success",{file:s,fileList:D.value,formData:a}))}(a,e,s):S(a,e,s)},fail(a){S(a,e,s)}}).onProgressUpdate((s=>{!function(e,s){const a=D.value.findIndex((e=>e.uid===s.uid));a>-1&&(D.value[a].percent=e.progress,x("progress",{response:e,file:s}))}(s,e)}))}function O(){const{multiple:s,maxSize:a,accept:o,sizeType:t,limit:i,sourceType:l,beforeUpload:n}=L;"image"===o&&function({multiple:s,sizeType:a,sourceType:o,maxCount:t}){return new Promise(((i,l)=>{e({count:s?Math.min(t,9):1,sizeType:a,sourceType:o,success:i,fail:l})}))}({multiple:s,sizeType:t,sourceType:l,maxCount:i?i-D.value.length:9}).then((e=>{let o=Array.prototype.slice.call(e.tempFiles);s||(o=o.slice(0,1));const t=e=>{e.forEach((async e=>{var s;M(e.size)||(e.size=await(s=e.path,new Promise(((e,a)=>{T({src:s,success:s=>{e(s.height*s.width)},fail:()=>{a(0)}})})))),e.size<=a?function(e){const s={uid:E.id++,name:e.name||"",status:"loading",size:e.size,url:e.path,action:L.action,percent:0};D.value.push(s);const{buildFormData:a,formData:o={}}=L;a?a({file:s,formData:o,resolve:e=>{e&&N(s,e)}}):N(s,o)}(e):x("oversize",{file:e})}))};n?n({files:o,fileList:D.value,resolve:e=>{e&&t(o)}}):t(o)})).catch((e=>{x("chooseerror",{error:e})}))}function q(){if(L.disabled)return;const{beforeChoose:e}=L;e?e({fileList:D.value,resolve:e=>{e&&O()}}):O()}function G(e,s){D.value.splice(D.value.findIndex((s=>s.uid===e.uid)),1),x("change",{fileList:D.value}),x("remove",{file:e})}function H(e,s){const{onPreviewFail:a}=L;k({urls:s,current:s[e],fail(){a?a({index:e,imgList:s}):C({title:"预览图片失败",icon:"none"})}})}return o((()=>L.fileList),(e=>{const{statusKey:s}=L;if(U(e,D.value))return;const a=e.map((e=>(e.uid=E.id++,e[s]=e[s]||"success",e.action=L.action||"",e.response=e.response||"",e)));D.value=a}),{deep:!0,immediate:!0}),o((()=>L.limit),(e=>{e&&e<D.value.length&&console.error("[wot-design]Error: props limit must less than fileList.length")}),{deep:!0,immediate:!0}),o((()=>L.beforePreview),(e=>{e&&!K(e)&&"asyncfunction"!==A(e)&&console.error("The type of beforePreview must be Function")}),{deep:!0,immediate:!0}),o((()=>L.onPreviewFail),(e=>{e&&!K(e)&&"asyncfunction"!==A(e)&&console.error("The type of onPreviewFail must be Function")}),{deep:!0,immediate:!0}),o((()=>L.beforeRemove),(e=>{e&&!K(e)&&"asyncfunction"!==A(e)&&console.error("The type of beforeRemove must be Function")}),{deep:!0,immediate:!0}),o((()=>L.beforeUpload),(e=>{e&&!K(e)&&"asyncfunction"!==A(e)&&console.error("The type of beforeUpload must be Function")}),{deep:!0,immediate:!0}),o((()=>L.beforeChoose),(e=>{e&&!K(e)&&"asyncfunction"!==A(e)&&console.error("The type of beforeChoose must be Function")}),{deep:!0,immediate:!0}),o((()=>L.buildFormData),(e=>{e&&!K(e)&&"asyncfunction"!==A(e)&&console.error("The type of buildFormData must be Function")}),{deep:!0,immediate:!0}),(e,s)=>{const a=b,o=g,k=t(i("wd-loading"),I),C=F,T=t(i("wd-icon"),j);return l(),n(o,{class:f(["wd-upload",e.customClass]),style:w(e.customStyle)},{default:u((()=>[(l(!0),r(c,null,d(D.value,((s,t)=>(l(),n(o,{class:f(["wd-upload__preview",e.customPreviewClass]),key:t},{default:u((()=>[m(o,{class:"wd-upload__status-content"},{default:u((()=>[m(a,{src:s.url,mode:e.imageMode,class:"wd-upload__picture",onClick:e=>function(e){const{beforePreview:s}=L,a=D.value.map((e=>e.url));s?s({index:e,imgList:a,resolve:s=>{s&&H(e,a)}}):H(e,a)}(t)},null,8,["src","mode","onClick"])])),_:2},1024),"success"!==s.status?(l(),n(o,{key:0,class:"wd-upload__mask wd-upload__status-content"},{default:u((()=>["loading"===s.status?(l(),n(o,{key:0,class:"wd-upload__status-content"},{default:u((()=>[m(k,{type:e.loadingType,size:e.loadingSize,color:e.loadingColor},null,8,["type","size","color"]),m(C,{class:"wd-upload__progress-txt"},{default:u((()=>[p(v(s.percent)+"%",1)])),_:2},1024)])),_:2},1024)):y("",!0),"fail"===s.status?(l(),n(o,{key:1,class:"wd-upload__status-content"},{default:u((()=>[m(T,{name:"close-outline","custom-class":"wd-upload__icon"}),m(C,{class:"wd-upload__progress-txt"},{default:u((()=>[p(v(s.error||_(P)("error")),1)])),_:2},1024)])),_:2},1024)):y("",!0)])),_:2},1024)):y("",!0),"loading"===s.status||e.disabled?y("",!0):(l(),n(T,{key:1,name:"error-fill","custom-class":"wd-upload__close",onClick:e=>function(e){const{beforeRemove:s}=L,a=e,o=D.value[a];s?s({file:o,index:a,fileList:D.value,resolve:e=>{e&&G(o)}}):G(o)}(t)},null,8,["onClick"]))])),_:2},1032,["class"])))),128)),m(o,{onClick:q},{default:u((()=>[e.useDefaultSlot?h(e.$slots,"default",{key:0},void 0,!0):y("",!0),e.useDefaultSlot||e.limit&&!(D.value.length<e.limit)?y("",!0):(l(),n(o,{key:1,class:f(["wd-upload__evoke",e.disabled?"is-disabled":"",e.customEvokeClass])},{default:u((()=>[m(T,{class:"wd-upload__evoke-icon",name:"fill-camera"}),e.limit&&e.showLimitNum?(l(),n(o,{key:0,class:"wd-upload__evoke-num"},{default:u((()=>[p("（"+v(D.value.length)+"/"+v(e.limit)+"）",1)])),_:1})):y("",!0)])),_:1},8,["class"]))])),_:3})])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-a5fa0176"]]);export{O as _};
